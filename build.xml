<?xml version="1.0" encoding="UTF-8"?>

<project name="iPeer" basedir="." default="build">
    <target name="release" description="Prepare the release" depends="debug-off,packaging" />

    <target name="debug-off" description="turn off the debug">
        <reflexive file="app/config/core.php">
            <filterchain>
                <replaceregexp>
                    <regexp pattern="'DEBUG', 1" replace="'DEBUG', 0"/>
                </replaceregexp>
            </filterchain>
        </reflexive>
    </target>

    <target name="packaging" description="Packaging the release">
        <tar destfile="${phing.project.name}.tar.gz" compression="gzip">
            <fileset dir=".">
                <exclude name="**/.git/" />
                <exclude name="${phing.project.name}.tar.gz" />
                <exclude name="${phing.project.name}.zip" />
            </fileset>
        </tar>
        <filehash file="${phing.project.name}.tar.gz" hashtype="0" />
        <echo msg="${filehashvalue}" file="${phing.project.name}.tar.gz.md5" />
        <zip destfile="${phing.project.name}.zip">
            <fileset dir=".">
                <exclude name="**/.git/" />
                <exclude name="${phing.project.name}.tar.gz" />
                <exclude name="${phing.project.name}.zip" />
            </fileset>
        </zip>
        <filehash file="${phing.project.name}.zip" hashtype="0" />
        <echo msg="${filehashvalue}" file="${phing.project.name}.zip.md5" />
    </target>
</project>
