<?phpclass FacultyCoursesAccessControlComponent extends Object {  var $FacultyAcoUser;  var $FacultyAco;    function __construct() {  	$this->FacultyAcoUser = ClassRegistry::init('FacultyAcoUser');  	$this->FacultyAco = ClassRegistry::init('FacultyAco');  	$this->DepartmentUser = ClassRegistry::init('DepartmentUser');  }    function grantAccessPermission($facultyAcoId, $userId) {	$data['faculty_aco_id'] = $facultyAcoId;	$data['user_id'] = $userId;	$data['_create'] = 1;	$data['_read'] = 1;	$data['_update'] = 1;	$data['_delete'] = 1;	// Saves only if the parent node has been denied access permission	$parentAccessPermission = $this->_getParentsAccessPermission($facultyAcoId, $userId);	if(!$parentAccessPermission) {	  $this->FacultyAcoUser->save($data);	  return true;	} else {	  return false;	}  }    function denyAccessPermission($facultyAcoId, $userId) {  $data['faculty_aco_id'] = $facultyAcoId;  $data['user_id'] = $userId;	$data['_create'] = -1;	$data['_read'] = -1;	$data['_update'] = -1;	$data['_delete'] = -1;  	// Save only if it's the highest deny permission	$parentAccessPermission = $this->_getParentsAccessPermission($facultyAcoId, $userId);	if($parentAccessPermission) {	  $this->FacultyAcoUser->save($data);	  return true;	} else {	  return false;	}  }    function getAccessPermissions($userId){    $dept = $this->DepartmentUser->getDepartment($userId);    $aco = $this->FacultyAcoUser->getAco($dept['UserDept']['dept_id']);    $acoId = $aco['FacultyAcoUser']['faculty_aco_id'];    return $this->FacultyAco->children($acoId, false, 'id');      }  function getReadPermission($userId, $aco){        $dept = $this->DepartmentUser->getDepartment($userId);        $dept = $dept['DepartmentUser']['dept_id'];            return $this->getParentsReadPermission($aco, $dept);  }    function getParentsReadPermission($childNodeId, $deptId) {  	$parentNode = $this->FacultyAco->getparentnode($childNodeId);  	$permission = $this->FacultyAcoUser->getAccessPermissionByFacultyAcoIdUserId($childNodeId, $deptId);   	$accessible = null;    if(!empty($permission)){      $accessible = ($permission['FacultyAcoUser']['_read'] == 1 ? true : false);      return $accessible;    } else {      	        $accessible = $this->getParentsReadPermission($parentNode['FacultyAco']['id'], $deptId);    } 	return $accessible;  }    function _getParentsAccessPermission($childNodeId, $userId) {  	$parentNode = $this->FacultyAco->getparentnode($childNodeId);  	$accessible = null;  	// current childNode is already root; else has parent.  	if(empty($parentNode)) {	  $rootPermission = $this->FacultyAcoUser->getAccessPermissionByFacultyAcoIdUserId($childNodeId, $userId);	  $accessible = ($rootPermission['FacultyAcoUser']['_read'] == 1 ? true : false);  	} else {  	  $parentPermission = $this->FacultyAcoUser->getAccessPermissionByFacultyAcoIdUserId($parentNode['FacultyAco']['id'], $userId);  	  $accessible = ($parentPermission['FacultyAcoUser']['_read'] == 1 ? true : false);   	}  	return $accessible;  }}?>